# -*- coding: utf-8 -*-
import telebot
import time
import sys
import os

# ============================================================
# –ù–ê–°–¢–†–û–ô–ö–ê: –¢–æ–∫–µ–Ω –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Railway
# ============================================================
TOKEN = os.environ.get("BOT_TOKEN")

if not TOKEN:
    print("–û–®–ò–ë–ö–ê: –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω –±–æ—Ç–∞! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é BOT_TOKEN –≤ Railway")
    sys.exit(1)

bot = telebot.TeleBot(TOKEN)

# ============================================================
# –ë–ê–ó–ê –í–û–ü–†–û–°–û–í –ò –û–¢–í–ï–¢–û–í
# 
# –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
# - "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞" ‚Äî —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –∏—â–µ—Ç –≤ –≤–æ–ø—Ä–æ—Å–µ
# - "–æ—Ç–≤–µ—Ç" ‚Äî —á—Ç–æ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤ –æ—Ç–≤–µ—Ç
# 
# –ü—Ä–∞–≤–∏–ª–∞:
# - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–∏—à–∏—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏
# - –†–∞–∑–¥–µ–ª—è–π—Ç–µ —Å–ª–æ–≤–∞ –∑–∞–ø—è—Ç—ã–º–∏
# ============================================================

qa_base = [
    {
        "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞": ["–≥—Ä–∞—Ñ–∏–∫", "—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "–≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã", "—Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã", "–∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç"],
        "–æ—Ç–≤–µ—Ç": "üïê –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã:\n\n–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ü—è—Ç–Ω–∏—Ü–∞: 9:00 - 18:00\n–°—É–±–±–æ—Ç–∞: 10:00 - 15:00\n–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: –≤—ã—Ö–æ–¥–Ω–æ–π"
    },
    {
        "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞": ["–∫–æ–Ω—Ç–∞–∫—Ç", "—Ç–µ–ª–µ—Ñ–æ–Ω", "–ø–æ–∑–≤–æ–Ω–∏—Ç—å", "–Ω–æ–º–µ—Ä", "—Å–≤—è–∑–∞—Ç—å—Å—è"],
        "–æ—Ç–≤–µ—Ç": "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:\n\n–¢–µ–ª–µ—Ñ–æ–Ω: +375 (XX) XXX-XX-XX\nEmail: example@mail.com"
    },
    {
        "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞": ["–∞–¥—Ä–µ—Å", "–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è", "–∫–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è", "–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ", "–≥–¥–µ –≤—ã"],
        "–æ—Ç–≤–µ—Ç": "üìç –ù–∞—à –∞–¥—Ä–µ—Å:\n\n–≥. –ú–∏–Ω—Å–∫, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –æ—Ñ–∏—Å 101\n\n–û—Ä–∏–µ–Ω—Ç–∏—Ä: —Ä—è–¥–æ–º —Å–æ —Å—Ç–∞–Ω—Ü–∏–µ–π –º–µ—Ç—Ä–æ"
    },
    {
        "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞": ["–æ–ø–ª–∞—Ç–∞", "–æ–ø–ª–∞—Ç–∏—Ç—å", "–∑–∞–ø–ª–∞—Ç–∏—Ç—å", "—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã", "–∫–∞—Ä—Ç–∞", "–Ω–∞–ª–∏—á–Ω—ã–µ"],
        "–æ—Ç–≤–µ—Ç": "üí≥ –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:\n\n1. –ù–∞–ª–∏—á–Ω—ã–µ\n2. –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞\n3. –ï–†–ò–ü\n4. –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä–∞—Å—á—ë—Ç–Ω—ã–π —Å—á—ë—Ç"
    },
    {
        "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞": ["—Ü–µ–Ω–∞", "—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç", "–ø—Ä–∞–π—Å", "—Ç–∞—Ä–∏—Ñ"],
        "–æ—Ç–≤–µ—Ç": "üí∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ü–µ–Ω–∞—Ö:\n\n–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏: +375 (XX) XXX-XX-XX"
    },

    # ====================================
    # –î–û–ë–ê–í–õ–Ø–ô–¢–ï –°–í–û–ò –í–û–ü–†–û–°–´ –ù–ò–ñ–ï
    # –ö–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω:
    # ====================================
    #
    # {
    #     "–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞": ["—Å–ª–æ–≤–æ1", "—Å–ª–æ–≤–æ2", "—Å–ª–æ–≤–æ3"],
    #     "–æ—Ç–≤–µ—Ç": "–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞"
    # },
    #
]

# ============================================================
# –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï
# ============================================================
WELCOME_MESSAGE = """üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫.

–ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –Ω–∞ –Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∏—Ç—å.

–ù–∞–ø—Ä–∏–º–µ—Ä:
‚Ä¢ –ö–∞–∫–æ–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã?
‚Ä¢ –ö–∞–∫ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è?
‚Ä¢ –ö–∞–∫–æ–π –∞–¥—Ä–µ—Å?
‚Ä¢ –ö–∞–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã?

–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å üëá"""

# ============================================================
# –°–û–û–ë–©–ï–ù–ò–ï, –ö–û–ì–î–ê –ù–ï –ù–ê–®–Å–õ –û–¢–í–ï–¢
# ============================================================
NOT_FOUND_MESSAGE = """ü§î –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –Ω–∞—à—ë–ª –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å.

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
‚Ä¢ –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–ª–æ–≤–∞

–ò–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏: +375 (XX) XXX-XX-XX"""


# ============================================================
# –ö–û–î –†–ê–ë–û–¢–´ –ë–û–¢–ê (–Ω–µ –º–µ–Ω—è–π—Ç–µ)
# ============================================================

def find_answer(user_text):
    """–ò—â–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º"""
    user_text_lower = user_text.lower().strip()
    
    best_match = None
    best_score = 0
    
    for item in qa_base:
        score = 0
        for keyword in item["–∫–ª—é—á–µ–≤—ã–µ_—Å–ª–æ–≤–∞"]:
            if keyword in user_text_lower:
                score += len(keyword)
        
        if score > best_score:
            best_score = score
            best_match = item
    
    if best_match:
        return best_match["–æ—Ç–≤–µ—Ç"]
    else:
        return None


@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ /start –∏ /help"""
    try:
        bot.reply_to(message, WELCOME_MESSAGE)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è: {e}")


@bot.message_handler(content_types=['text'])
def handle_text(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    try:
        answer = find_answer(message.text)
        if answer:
            bot.reply_to(message, answer)
        else:
            bot.reply_to(message, NOT_FOUND_MESSAGE)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ: {e}")


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
print("–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
while True:
    try:
        print("–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç! –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
        bot.polling(none_stop=True, interval=2, timeout=60)
    except KeyboardInterrupt:
        print("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        sys.exit(0)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
        print("–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
        time.sleep(10)
